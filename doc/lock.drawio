<mxfile host="drawio-plugin" modified="2022-08-09T17:25:49.229Z" agent="5.0 (Android 6.0)" version="15.5.4" etag="Io00WlmKOUE-2Z0k8uZm" type="embed"><diagram id="ljtAD_c3fics7_P6mJIY" name="ReentrantLock加解锁分析"><mxGraphModel dx="1352" dy="596" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="11" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="60" width="160" height="80" as="geometry"/></mxCell><mxCell id="3" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="11"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="5" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="11"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="6" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="11"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="8" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="11"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="9" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="11"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="10" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="11"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="12" value="Node" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="100" y="150" width="40" height="20" as="geometry"/></mxCell><mxCell id="18" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="305" y="40" width="240" height="120" as="geometry"/></mxCell><mxCell id="13" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="18"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="14" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="18"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="15" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="18"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="16" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="18"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="17" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="18"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="19" value="AQS" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="405" y="170" width="40" height="20" as="geometry"/></mxCell><mxCell id="20" value="" style="line;strokeWidth=2;html=1;" vertex="1" parent="1"><mxGeometry x="40" y="200" width="780" height="10" as="geometry"/></mxCell><mxCell id="21" value="ReentrantLock -&amp;gt; lock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="40" y="210" width="130" height="20" as="geometry"/></mxCell><mxCell id="22" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="430" y="330" width="240" height="120" as="geometry"/></mxCell><mxCell id="23" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="22"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="24" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="25" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="26" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="27" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="30" value="&lt;font color=&quot;#ff3333&quot;&gt;0 -&amp;gt; 1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry x="95" y="30" width="50" height="20" as="geometry"/></mxCell><mxCell id="31" value="&lt;font color=&quot;#ff3333&quot;&gt;null -&amp;gt; A (thread id)&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="22"><mxGeometry x="60" y="80" width="120" height="20" as="geometry"/></mxCell><mxCell id="28" value="ReentrantLock (Non Fair)" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="475" y="300" width="150" height="20" as="geometry"/></mxCell><mxCell id="29" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1. thread A 通过CAS修改state的值，将其从0变为1；&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;如果成功，将当前线程写入到ReentrantLock中&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="50" y="375" width="300" height="30" as="geometry"/></mxCell><mxCell id="32" value="&lt;font color=&quot;#ffffff&quot;&gt;Situation 1: 锁没有被占用时，直接获取锁&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FF3333;" vertex="1" parent="1"><mxGeometry x="280" y="270" width="230" height="20" as="geometry"/></mxCell><mxCell id="36" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontColor=#FFFFFF;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="40" y="480" as="sourcePoint"/><mxPoint x="822" y="480" as="targetPoint"/></mxGeometry></mxCell><mxCell id="37" value="&lt;font color=&quot;#ffffff&quot;&gt;Situation 2: 锁被A线程占用，线程B尝试获取锁&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FF3333;" vertex="1" parent="1"><mxGeometry x="265" y="500" width="260" height="20" as="geometry"/></mxCell><mxCell id="38" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="430" y="570" width="240" height="120" as="geometry"/></mxCell><mxCell id="39" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="38"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="40" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="38"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="41" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="38"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="42" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="38"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="43" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="38"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="44" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="38"><mxGeometry x="110" y="30" width="20" height="20" as="geometry"/></mxCell><mxCell id="45" value="A" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="38"><mxGeometry x="110" y="80" width="20" height="20" as="geometry"/></mxCell><mxCell id="46" value="&lt;div style=&quot;color: rgb(240 , 240 , 240) ; text-align: left&quot;&gt;1. thread B 通过CAS尝试修改state的值，将其从0变为1；&lt;/div&gt;&lt;div style=&quot;color: rgb(240 , 240 , 240) ; text-align: left&quot;&gt;失败，调用ReentrantLock的acquire方法&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="552.5" width="320" height="30" as="geometry"/></mxCell><mxCell id="47" value="2. 重新获取一次state的值，如果变为0，说明A线程已经释放了锁，&lt;br&gt;直接尝试CAS设置state为1；" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="612.5" width="370" height="30" as="geometry"/></mxCell><mxCell id="48" value="3. 如果state不为1，那么查看当前线程是否为Lock中保存的&lt;br&gt;exclusiveOwnerThread值，如果是当前线程，对于可重入锁&lt;br&gt;来说，可以获取锁，将state的值+1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="657.5" width="330" height="50" as="geometry"/></mxCell><mxCell id="49" value="这个阶段尝试直接修改state值，看是否能拿到锁，或者是否为可重入锁" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="770" y="612.5" width="390" height="20" as="geometry"/></mxCell><mxCell id="50" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontColor=#FFFFFF;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="40" y="730" as="sourcePoint"/><mxPoint x="818" y="730" as="targetPoint"/></mxGeometry></mxCell><mxCell id="51" value="这个阶段继续尝试是否可以直接获取state值，否则将线程B设置为阻塞，并加入队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="735" y="770" width="460" height="20" as="geometry"/></mxCell><mxCell id="52" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="490" y="1040" width="160" height="80" as="geometry"/></mxCell><mxCell id="53" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="52"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="54" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="52"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="55" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="52"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="56" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="52"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="57" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="52"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="58" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="52"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="60" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="52"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="61" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="52"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="62" value="B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="52"><mxGeometry x="15" y="40" width="20" height="20" as="geometry"/></mxCell><mxCell id="59" value="Node for Thread B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="510" y="1130" width="110" height="20" as="geometry"/></mxCell><mxCell id="63" value="1. 为线程B准备好要加入队列的Node" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="580" y="1000" width="210" height="20" as="geometry"/></mxCell><mxCell id="64" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="760" width="240" height="120" as="geometry"/></mxCell><mxCell id="65" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="64"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="66" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="64"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="67" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="64"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="68" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="64"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="69" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="64"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="70" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="64"><mxGeometry x="110" y="30" width="20" height="20" as="geometry"/></mxCell><mxCell id="71" value="A" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="64"><mxGeometry x="110" y="80" width="20" height="20" as="geometry"/></mxCell><mxCell id="72" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="1040" width="160" height="80" as="geometry"/></mxCell><mxCell id="73" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="72"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="74" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="72"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="75" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="72"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="76" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="72"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="77" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="72"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="78" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="72"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="79" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="72"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="80" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="72"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="82" value="Dummy node" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="75" y="1130" width="90" height="20" as="geometry"/></mxCell><mxCell id="86" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.518;exitY=1.188;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="68" target="74"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="50" y="1000" as="sourcePoint"/><mxPoint x="100" y="950" as="targetPoint"/></mxGeometry></mxCell><mxCell id="87" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.567;exitY=1.082;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="69" target="73"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="70.7199999999998" y="843.76" as="sourcePoint"/><mxPoint x="70" y="1050" as="targetPoint"/><Array as="points"><mxPoint x="267" y="940"/><mxPoint x="160" y="940"/></Array></mxGeometry></mxCell><mxCell id="88" value="2. init a dummy node" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="175" y="990" width="130" height="20" as="geometry"/></mxCell><mxCell id="90" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=-0.052;exitY=0.545;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="54"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="70.72000000000003" y="843.76" as="sourcePoint"/><mxPoint x="200" y="1050" as="targetPoint"/></mxGeometry></mxCell><mxCell id="91" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;entryX=-0.079;entryY=1.1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.062;exitY=0.992;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="75" target="54"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="230" y="1100" as="sourcePoint"/><mxPoint x="210" y="1060" as="targetPoint"/></mxGeometry></mxCell><mxCell id="92" value="3. 将新的节点加入到tail指向到队尾" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="245" y="1070" width="200" height="20" as="geometry"/></mxCell><mxCell id="93" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=1.072;exitY=0.61;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="69" target="53"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="277.01" y="841.6400000000001" as="sourcePoint"/><mxPoint x="170" y="1050" as="targetPoint"/><Array as="points"><mxPoint x="570" y="822"/><mxPoint x="570" y="950"/></Array></mxGeometry></mxCell><mxCell id="94" value="3. 将新的节点加入到tail指向到队尾" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="370" y="830" width="200" height="20" as="geometry"/></mxCell><mxCell id="95" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontColor=#FFFFFF;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="30" y="1180" as="sourcePoint"/><mxPoint x="808" y="1180" as="targetPoint"/></mxGeometry></mxCell><mxCell id="96" value="这个阶段尝试再次获取锁，如果没有获取成功，将线程B阻塞" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="750" y="1200" width="340" height="20" as="geometry"/></mxCell><mxCell id="97" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="490" y="1490" width="160" height="80" as="geometry"/></mxCell><mxCell id="98" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="97"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="99" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="97"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="100" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="97"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="101" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="97"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="102" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="97"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="103" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="97"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="104" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="97"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="105" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="97"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="106" value="B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="97"><mxGeometry x="15" y="40" width="20" height="20" as="geometry"/></mxCell><mxCell id="107" value="Node for Thread B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="515" y="1580" width="110" height="20" as="geometry"/></mxCell><mxCell id="108" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="1210" width="240" height="120" as="geometry"/></mxCell><mxCell id="109" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="108"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="110" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="108"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="111" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="108"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="112" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="108"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="113" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="108"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="114" value="1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="108"><mxGeometry x="110" y="30" width="20" height="20" as="geometry"/></mxCell><mxCell id="115" value="A" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="108"><mxGeometry x="110" y="80" width="20" height="20" as="geometry"/></mxCell><mxCell id="116" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="1490" width="160" height="80" as="geometry"/></mxCell><mxCell id="117" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="116"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="118" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="116"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="119" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="116"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="120" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="116"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="121" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="116"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="122" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="116"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="123" value="-1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="116"><mxGeometry x="65" y="10" width="30" height="20" as="geometry"/></mxCell><mxCell id="124" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="116"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="125" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.518;exitY=1.188;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="112" target="118" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="50" y="1450" as="sourcePoint"/><mxPoint x="100" y="1400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="128" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=-0.052;exitY=0.545;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="99" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="70.72000000000003" y="1293.76" as="sourcePoint"/><mxPoint x="200" y="1500" as="targetPoint"/></mxGeometry></mxCell><mxCell id="129" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;entryX=-0.079;entryY=1.1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.062;exitY=0.992;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="119" target="99" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="230" y="1550" as="sourcePoint"/><mxPoint x="210" y="1510" as="targetPoint"/></mxGeometry></mxCell><mxCell id="131" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=1.072;exitY=0.61;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="113" target="98" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="277.01" y="1291.64" as="sourcePoint"/><mxPoint x="170" y="1500" as="targetPoint"/><Array as="points"><mxPoint x="570" y="1272"/><mxPoint x="570" y="1400"/></Array></mxGeometry></mxCell><mxCell id="133" value="1. 尝试将waitStatus设置为-1 （Singal）直至成功" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="80" y="1460" width="280" height="20" as="geometry"/></mxCell><mxCell id="134" value="2. 阻塞线程B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="680" y="1510" width="80" height="20" as="geometry"/></mxCell><mxCell id="135" value="" style="line;strokeWidth=2;html=1;" vertex="1" parent="1"><mxGeometry x="20" y="1620" width="780" height="10" as="geometry"/></mxCell><mxCell id="136" value="ReentrantLock -&amp;gt; unlock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="35" y="1640" width="150" height="20" as="geometry"/></mxCell><mxCell id="137" value="1. unlock操作只能由拥有锁的线程发起" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="1680" width="220" height="20" as="geometry"/></mxCell><mxCell id="138" value="2. 只有子类实现的tryRelease返回true才会执行dequeue操作" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="1700" width="330" height="20" as="geometry"/></mxCell><mxCell id="139" value="3. 对于ReentrantLock来说，由于是可以重入的，所以只有当state的值为0的时候，tryRelease方法才会返回true" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="1720" width="600" height="20" as="geometry"/></mxCell><mxCell id="140" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="500" y="2050" width="160" height="80" as="geometry"/></mxCell><mxCell id="141" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="140"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="142" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="140"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="143" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="140"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="144" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="140"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="145" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="140"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="146" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="140"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="147" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="140"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="148" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="140"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="149" value="B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="140"><mxGeometry x="15" y="40" width="20" height="20" as="geometry"/></mxCell><mxCell id="150" value="Node for Thread B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="525" y="2140" width="110" height="20" as="geometry"/></mxCell><mxCell id="151" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="50" y="1770" width="240" height="120" as="geometry"/></mxCell><mxCell id="152" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="151"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="153" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="151"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="154" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="151"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="155" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="151"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="156" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="151"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="157" value="1 -&amp;gt; 0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="151"><mxGeometry x="95" y="30" width="50" height="20" as="geometry"/></mxCell><mxCell id="158" value="A -&amp;gt; null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="151"><mxGeometry x="90" y="80" width="60" height="20" as="geometry"/></mxCell><mxCell id="159" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="50" y="2050" width="160" height="80" as="geometry"/></mxCell><mxCell id="160" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="159"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="161" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="159"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="162" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="159"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="163" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="159"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="164" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="159"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="165" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="159"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="166" value="-1 -&amp;gt; 0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="159"><mxGeometry x="55" y="10" width="50" height="20" as="geometry"/></mxCell><mxCell id="167" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="159"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="168" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.518;exitY=1.188;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="155" target="161" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="60" y="2010" as="sourcePoint"/><mxPoint x="110" y="1960" as="targetPoint"/></mxGeometry></mxCell><mxCell id="169" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=-0.052;exitY=0.545;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="142" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="80.72000000000003" y="1853.76" as="sourcePoint"/><mxPoint x="210" y="2060" as="targetPoint"/></mxGeometry></mxCell><mxCell id="170" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;entryX=-0.079;entryY=1.1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.062;exitY=0.992;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="162" target="142" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="240" y="2110" as="sourcePoint"/><mxPoint x="220" y="2070" as="targetPoint"/></mxGeometry></mxCell><mxCell id="171" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=1.072;exitY=0.61;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="156" target="141" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="287.01" y="1851.64" as="sourcePoint"/><mxPoint x="180" y="2060" as="targetPoint"/><Array as="points"><mxPoint x="580" y="1832"/><mxPoint x="580" y="1960"/></Array></mxGeometry></mxCell><mxCell id="172" value="4. 查看head的waitStatus状态是否为0，不为0则尝试唤醒头节点的后继节点指向的线程&lt;br&gt;如果确认执行唤醒操作，首先将头节点的waitState设置为0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="90" y="2000" width="470" height="30" as="geometry"/></mxCell><mxCell id="173" value="唤醒B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="705" y="2070" width="50" height="20" as="geometry"/></mxCell><mxCell id="174" value="5. 唤醒后的线程B从上次被阻塞的地方继续执行，首先检查其前向节点是否为head，&lt;br&gt;只有为head时，才会去尝试抢占锁；" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="100" y="2160" width="460" height="30" as="geometry"/></mxCell><mxCell id="175" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontColor=#FFFFFF;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="36" y="2240" as="sourcePoint"/><mxPoint x="814" y="2240" as="targetPoint"/></mxGeometry></mxCell><mxCell id="176" value="这阶段主要尝试唤醒头节点的后继线程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="625" y="1770" width="220" height="20" as="geometry"/></mxCell><mxCell id="178" value="如果B抢占到了锁" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="40" y="2250" width="110" height="20" as="geometry"/></mxCell><mxCell id="179" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="490" y="2570" width="160" height="80" as="geometry"/></mxCell><mxCell id="180" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="179"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="181" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="179"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="182" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="179"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="183" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="179"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="184" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="179"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="185" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="179"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="186" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="179"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="187" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="179"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="188" value="B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="179"><mxGeometry x="15" y="40" width="20" height="20" as="geometry"/></mxCell><mxCell id="189" value="Node for Thread B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="515" y="2660" width="110" height="20" as="geometry"/></mxCell><mxCell id="190" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="2290" width="240" height="120" as="geometry"/></mxCell><mxCell id="191" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="190"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="192" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="190"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="193" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="190"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="194" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="190"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="195" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="190"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="196" value="0 -&amp;gt; 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="190"><mxGeometry x="95" y="30" width="50" height="20" as="geometry"/></mxCell><mxCell id="197" value="null -&amp;gt; B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="190"><mxGeometry x="90" y="80" width="60" height="20" as="geometry"/></mxCell><mxCell id="198" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="40" y="2570" width="160" height="80" as="geometry"/></mxCell><mxCell id="199" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="198"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="200" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="198"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="201" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="198"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="202" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="198"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="203" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="198"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="204" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="198"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="205" value="-1 -&amp;gt; 0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="198"><mxGeometry x="55" y="10" width="50" height="20" as="geometry"/></mxCell><mxCell id="206" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="198"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="207" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.518;exitY=1.188;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.331;entryY=0.007;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" source="194" target="180" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="50" y="2530" as="sourcePoint"/><mxPoint x="100" y="2480" as="targetPoint"/><Array as="points"><mxPoint x="61" y="2460"/><mxPoint x="543" y="2460"/></Array></mxGeometry></mxCell><mxCell id="210" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=1.072;exitY=0.61;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="195" target="180" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="277.01" y="2371.6400000000003" as="sourcePoint"/><mxPoint x="170" y="2580" as="targetPoint"/><Array as="points"><mxPoint x="570" y="2352"/><mxPoint x="570" y="2480"/></Array></mxGeometry></mxCell><mxCell id="213" value="这阶段主要是调整lock中的数据，使得B变为头节点" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="550" y="2260" width="280" height="20" as="geometry"/></mxCell><mxCell id="214" value="等待被回收" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="80" y="2550" width="80" height="20" as="geometry"/></mxCell><mxCell id="215" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;fontColor=#FFFFFF;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="28" y="2720" as="sourcePoint"/><mxPoint x="806" y="2720" as="targetPoint"/></mxGeometry></mxCell><mxCell id="216" value="如果B没有抢占到锁，而是被C线程抢到了" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="30" y="2730" width="240" height="20" as="geometry"/></mxCell><mxCell id="217" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="482" y="3050" width="160" height="80" as="geometry"/></mxCell><mxCell id="218" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="217"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="219" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="217"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="220" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="217"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="221" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="217"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="222" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="217"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="223" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="217"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="224" value="0" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="217"><mxGeometry x="70" y="10" width="20" height="20" as="geometry"/></mxCell><mxCell id="225" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="217"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="226" value="B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="217"><mxGeometry x="15" y="40" width="20" height="20" as="geometry"/></mxCell><mxCell id="227" value="Node for Thread B" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1"><mxGeometry x="507" y="3140" width="110" height="20" as="geometry"/></mxCell><mxCell id="228" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="32" y="2770" width="240" height="120" as="geometry"/></mxCell><mxCell id="229" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="228"><mxGeometry width="240" height="120" as="geometry"/></mxCell><mxCell id="230" value="exclusiveOwnerThread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="228"><mxGeometry x="50" y="100" width="140" height="20" as="geometry"/></mxCell><mxCell id="231" value="state" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="228"><mxGeometry x="100" y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="232" value="head" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="228"><mxGeometry y="50" width="40" height="20" as="geometry"/></mxCell><mxCell id="233" value="tail" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="228"><mxGeometry x="210" y="50" width="30" height="20" as="geometry"/></mxCell><mxCell id="234" value="0 -&amp;gt; 1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="228"><mxGeometry x="95" y="30" width="50" height="20" as="geometry"/></mxCell><mxCell id="235" value="null -&amp;gt; C" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="228"><mxGeometry x="90" y="80" width="60" height="20" as="geometry"/></mxCell><mxCell id="236" value="" style="group" vertex="1" connectable="0" parent="1"><mxGeometry x="32" y="3050" width="160" height="80" as="geometry"/></mxCell><mxCell id="237" value="" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="236"><mxGeometry width="160" height="80" as="geometry"/></mxCell><mxCell id="238" value="prev" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="236"><mxGeometry width="40" height="20" as="geometry"/></mxCell><mxCell id="239" value="next" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="236"><mxGeometry x="120" width="40" height="20" as="geometry"/></mxCell><mxCell id="240" value="waitStatus" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="236"><mxGeometry x="45" y="30" width="70" height="20" as="geometry"/></mxCell><mxCell id="241" value="nextWaiter" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="236"><mxGeometry x="90" y="60" width="70" height="20" as="geometry"/></mxCell><mxCell id="242" value="thread" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="236"><mxGeometry y="60" width="50" height="20" as="geometry"/></mxCell><mxCell id="243" value="&amp;nbsp;0 -&amp;gt; -1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="236"><mxGeometry x="55" y="10" width="50" height="20" as="geometry"/></mxCell><mxCell id="244" value="null" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="236"><mxGeometry x="110" y="40" width="30" height="20" as="geometry"/></mxCell><mxCell id="245" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=0.518;exitY=1.188;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.534;entryY=0.053;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" source="232" target="238" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="42" y="3010" as="sourcePoint"/><mxPoint x="53" y="3000" as="targetPoint"/><Array as="points"/></mxGeometry></mxCell><mxCell id="246" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=1.072;exitY=0.61;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="233" target="218" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="269.01" y="2851.6400000000003" as="sourcePoint"/><mxPoint x="162" y="3060" as="targetPoint"/><Array as="points"><mxPoint x="562" y="2832"/><mxPoint x="562" y="2960"/></Array></mxGeometry></mxCell><mxCell id="247" value="1. 如果没有抢占到锁，说明有新的线程在tryAcquire阶段获取了锁，那么等待队列不需要调整&lt;br&gt;2. 如果新的要抢占锁的线程也建立了节点，并入了队列，那么这个线程的节点肯定是在B线程节点的后面，&lt;br&gt;也就是说不满足是头节点的后继节点，这时新的线程根本不会参加竞争锁（CAS方式）&lt;br&gt;3. 所以，如果有新的线程抢到了锁，只能是在tryAcquire阶段" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="310" y="2740" width="580" height="60" as="geometry"/></mxCell><mxCell id="248" value="等待被回收" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="72" y="3030" width="80" height="20" as="geometry"/></mxCell><mxCell id="249" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;exitX=-0.052;exitY=0.545;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="479.9200000000001" y="3060.9" as="sourcePoint"/><mxPoint x="192" y="3060" as="targetPoint"/></mxGeometry></mxCell><mxCell id="250" value="" style="endArrow=classic;html=1;rounded=0;fontColor=#FFFFFF;entryX=0.107;entryY=1.096;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="219"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="194" y="3072" as="sourcePoint"/><mxPoint x="478.8399999999999" y="3072" as="targetPoint"/></mxGeometry></mxCell><mxCell id="251" value="B线程再次阻塞" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="580" y="3020" width="100" height="20" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>